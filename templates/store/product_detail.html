{% extends 'Home/base.html' %}
{% load static %}

{% block title %}{{ product.name }} | Fashion{% endblock %}
{% block meta_description %}{{ product.description|truncatewords:20 }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'main:home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'main:shop' %}">Shop</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
{% endblock %}

{% block content %}
<!-- Product Detail Section -->
<section class="product-detail-area section-padding30">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
            <div class="col-lg-6 col-md-6">
                <div class="product-images">
                    <div class="main-image mb-30">
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid">
                    </div>
                    <div class="thumbnail-images">
                        <div class="row">
                            {% for image in product.images.all %}
                            <div class="col-3">
                                <img src="{{ image.image.url }}" alt="{{ product.name }}" class="img-fluid thumbnail-img">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-lg-6 col-md-6">
                <div class="product-info">
                    <h1 class="product-title">{{ product.name }}</h1>
                    
                    <div class="product-rating mb-20">
                        <div class="stars">
                            {% for i in "12345" %}
                            <i class="fas fa-star"></i>
                            {% endfor %}
                        </div>
                        <span class="rating-text">({{ product.review_count }} reviews)</span>
                    </div>

                    <div class="product-price mb-20">
                        <span class="current-price">${{ product.price }}</span>
                        {% if product.old_price %}
                        <span class="old-price">${{ product.old_price }}</span>
                        <span class="discount-badge">-{{ product.discount_percentage }}%</span>
                        {% endif %}
                    </div>

                    <div class="product-description mb-30">
                        <p>{{ product.description }}</p>
                    </div>

                    <!-- Product Options -->
                    {% if product.has_variants %}
                    <div class="product-options mb-30">
                        <!-- Size Selection -->
                        {% if product.sizes.all %}
                        <div class="option-group mb-20">
                            <label>Size:</label>
                            <div class="size-options">
                                {% for size in product.sizes.all %}
                                <input type="radio" name="size" id="size_{{ size.id }}" value="{{ size.id }}">
                                <label for="size_{{ size.id }}">{{ size.name }}</label>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Color Selection -->
                        {% if product.colors.all %}
                        <div class="option-group mb-20">
                            <label>Color:</label>
                            <div class="color-options">
                                {% for color in product.colors.all %}
                                <input type="radio" name="color" id="color_{{ color.id }}" value="{{ color.id }}">
                                <label for="color_{{ color.id }}" style="background-color: {{ color.hex_code }}">{{ color.name }}</label>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Quantity and Add to Cart -->
                    <div class="product-actions mb-30">
                        <div class="quantity-selector mb-20">
                            <label>Quantity:</label>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus">-</button>
                                <input type="number" value="1" min="1" max="{{ product.stock }}" class="qty-input">
                                <button type="button" class="qty-btn plus">+</button>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary btn-lg add-to-cart" data-product-id="{{ product.id }}">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                            <button class="btn btn-outline-primary btn-lg wishlist-btn" data-product-id="{{ product.id }}">
                                <i class="far fa-heart"></i> Wishlist
                            </button>
                        </div>
                    </div>

                    <!-- Product Meta -->
                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="label">SKU:</span>
                            <span class="value">{{ product.sku }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="label">Category:</span>
                            <span class="value">{{ product.category.name }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="label">Availability:</span>
                            <span class="value {% if product.in_stock %}in-stock{% else %}out-of-stock{% endif %}">
                                {% if product.in_stock %}In Stock{% else %}Out of Stock{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Tabs -->
        <div class="row mt-50">
            <div class="col-12">
                <div class="product-tabs">
                    <ul class="nav nav-tabs" id="productTabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab">Description</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="specifications-tab" data-toggle="tab" href="#specifications" role="tab">Specifications</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab">Reviews</a>
                        </li>
                    </ul>

                    <div class="tab-content" id="productTabsContent">
                        <!-- Description Tab -->
                        <div class="tab-pane fade show active" id="description" role="tabpanel">
                            <div class="tab-content-body">
                                {{ product.full_description|safe }}
                            </div>
                        </div>

                        <!-- Specifications Tab -->
                        <div class="tab-pane fade" id="specifications" role="tabpanel">
                            <div class="tab-content-body">
                                <table class="table specifications-table">
                                    <tbody>
                                        {% for spec in product.specifications.all %}
                                        <tr>
                                            <td class="spec-label">{{ spec.name }}</td>
                                            <td class="spec-value">{{ spec.value }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Reviews Tab -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel">
                            <div class="tab-content-body">
                                <div class="reviews-section">
                                    {% for review in product.reviews.all %}
                                    <div class="review-item mb-30">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <h5>{{ review.user.get_full_name|default:review.user.username }}</h5>
                                                <div class="review-rating">
                                                    {% for i in "12345" %}
                                                    <i class="fas fa-star {% if forloop.counter <= review.rating %}filled{% endif %}"></i>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="review-date">{{ review.created_at|date:"M d, Y" }}</div>
                                        </div>
                                        <div class="review-content">
                                            <p>{{ review.comment }}</p>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <p>No reviews yet. Be the first to review this product!</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="row mt-50">
            <div class="col-12">
                <div class="section-tittle text-center mb-50">
                    <h2>Related Products</h2>
                </div>
                <div class="row">
                    {% for related_product in related_products %}
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="single-product mb-30">
                            <div class="product-img">
                                <img src="{{ related_product.image.url }}" alt="{{ related_product.name }}">
                                <div class="product-overlay">
                                    <div class="overlay-content">
                                        <a href="{% url 'main:product_detail' related_product.id %}" class="btn btn-primary">View Details</a>
                                    </div>
                                </div>
                            </div>
                            <div class="product-caption text-center">
                                <h4><a href="{% url 'main:product_detail' related_product.id %}">{{ related_product.name }}</a></h4>
                                <div class="price">
                                    <span class="current-price">${{ related_product.price }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

