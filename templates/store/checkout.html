{% extends 'Home/base.html' %}
{% load static %}

{% block title %}Checkout | Fashion{% endblock %}
{% block meta_description %}Complete your purchase{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'main:home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'main:cart' %}">Cart</a></li>
<li class="breadcrumb-item active" aria-current="page">Checkout</li>
{% endblock %}

{% block content %}
<!-- Checkout Section -->
<section class="checkout-area section-padding30">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h1 class="checkout-title">Complete Your Purchase</h1>
                <p class="checkout-subtitle">Almost there! Just a few more steps to complete your order.</p>
            </div>
        </div>
        
        <div class="row">
            <!-- Checkout Form -->
            <div class="col-lg-8 col-md-7">
                <div class="checkout-form-container">
                    <form id="checkout-form" class="checkout-form">
                        <!-- Shipping Information -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-shipping-fast"></i>
                                Shipping Information
                            </h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="first_name">First Name *</label>
                                        <input type="text" id="first_name" name="first_name" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_name">Last Name *</label>
                                        <input type="text" id="last_name" name="last_name" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" name="email" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="phone">Phone Number *</label>
                                        <input type="tel" id="phone" name="phone" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address">Street Address *</label>
                                <input type="text" id="address" name="address" class="form-control" required>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="city">City *</label>
                                        <input type="text" id="city" name="city" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="state">State/Province *</label>
                                        <input type="text" id="state" name="state" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="zip_code">ZIP/Postal Code *</label>
                                        <input type="text" id="zip_code" name="zip_code" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="country">Country *</label>
                                <select id="country" name="country" class="form-control" required>
                                    <option value="">Select Country</option>
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="AU">Australia</option>
                                    <option value="DE">Germany</option>
                                    <option value="FR">France</option>
                                    <option value="JP">Japan</option>
                                    <option value="CN">China</option>
                                    <option value="IN">India</option>
                                </select>
                            </div>
                        </div>

                        <!-- Shipping Options -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-truck"></i>
                                Shipping Options
                            </h3>
                            <div class="shipping-options">
                                <div class="shipping-option">
                                    <input type="radio" id="standard" name="shipping" value="standard" checked>
                                    <label for="standard">
                                        <div class="option-content">
                                            <div class="option-header">
                                                <span class="option-name">Standard Shipping</span>
                                                <span class="option-price">$2.00</span>
                                            </div>
                                            <span class="option-desc">5-7 business days</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="shipping-option">
                                    <input type="radio" id="express" name="shipping" value="express">
                                    <label for="express">
                                        <div class="option-content">
                                            <div class="option-header">
                                                <span class="option-name">Express Shipping</span>
                                                <span class="option-price">$8.00</span>
                                            </div>
                                            <span class="option-desc">2-3 business days</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="shipping-option">
                                    <input type="radio" id="overnight" name="shipping" value="overnight">
                                    <label for="overnight">
                                        <div class="option-content">
                                            <div class="option-header">
                                                <span class="option-name">Overnight</span>
                                                <span class="option-price">$15.00</span>
                                            </div>
                                            <span class="option-desc">Next business day</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Information -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-credit-card"></i>
                                Payment Information
                            </h3>
                            <div class="payment-methods">
                                <div class="payment-method">
                                    <input type="radio" id="credit_card" name="payment" value="credit_card" checked>
                                    <label for="credit_card">
                                        <i class="fas fa-credit-card"></i>
                                        Credit/Debit Card
                                    </label>
                                </div>
                                <div class="payment-method">
                                    <input type="radio" id="paypal" name="payment" value="paypal">
                                    <label for="paypal">
                                        <i class="fab fa-paypal"></i>
                                        PayPal
                                    </label>
                                </div>
                            </div>
                            
                            <div id="credit-card-form" class="credit-card-form">
                                <div class="form-group">
                                    <label for="card_number">Card Number *</label>
                                    <input type="text" id="card_number" name="card_number" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19">
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="expiry">Expiry Date *</label>
                                            <input type="text" id="expiry" name="expiry" class="form-control" placeholder="MM/YY" maxlength="5">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="cvv">CVV *</label>
                                            <input type="text" id="cvv" name="cvv" class="form-control" placeholder="123" maxlength="4">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="card_name">Name on Card *</label>
                                    <input type="text" id="card_name" name="card_name" class="form-control" required>
                                </div>
                            </div>
                        </div>

                        <!-- Order Notes -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-sticky-note"></i>
                                Order Notes (Optional)
                            </h3>
                            <div class="form-group">
                                <textarea id="order_notes" name="order_notes" class="form-control" rows="3" placeholder="Any special instructions or notes for your order..."></textarea>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-section">
                            <div class="form-check">
                                <input type="checkbox" id="terms" name="terms" class="form-check-input" required>
                                <label for="terms" class="form-check-label">
                                    I agree to the <a href="#" class="terms-link">Terms and Conditions</a> and <a href="#" class="terms-link">Privacy Policy</a> *
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-section">
                            <button type="submit" class="btn btn-primary btn-lg checkout-btn" id="place-order-btn">
                                <i class="fas fa-lock"></i>
                                Place Order
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4 col-md-5">
                <div class="order-summary-container">
                    <div class="order-summary">
                        <h3 class="summary-title">
                            <i class="fas fa-receipt"></i>
                            Order Summary
                        </h3>
                        
                        <div class="summary-items" id="summary-items">
                            <!-- Items will be populated by JavaScript -->
                        </div>
                        
                        <div class="summary-totals">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="subtotal">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Shipping:</span>
                                <span id="shipping-cost">$2.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax:</span>
                                <span id="tax-amount">$0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total:</span>
                                <span id="total-amount">$0.00</span>
                            </div>
                        </div>
                        
                        <div class="summary-actions">
                            <a href="{% url 'main:cart' %}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-arrow-left"></i>
                                Back to Cart
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Checkout Styling */
.checkout-area {
    padding: 30px 0;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.checkout-title {
    font-size: 44px;
    font-weight: 800;
    color: #333;
    margin-bottom: 10px;
}

.checkout-subtitle {
    font-size: 24px;
    color: #6c757d;
    margin-bottom: 0;
}

/* Form Container */
.checkout-form-container {
    background: white;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    margin-bottom: 0;
    border: 1px solid rgba(255,255,255,0.8);
}

.form-section {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e9ecef;
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.section-title {
    font-size: 26px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.section-title i {
    color: #007bff;
    font-size: 18px;
}

/* Form Groups */
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
    font-size: 20px;
}

.form-control {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 16px 20px;
    font-size: 20px;
    transition: all 0.3s ease;
}

.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.3rem rgba(0, 123, 255, 0.25);
    outline: none;
    transform: translateY(-1px);
}

.form-control.is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.form-control.is-invalid:focus {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

/* Shipping Options */
.shipping-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.shipping-option {
    position: relative;
}

.shipping-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.shipping-option label {
    display: block;
    padding: 22px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.shipping-option input[type="radio"]:checked + label {
    border-color: #007bff;
    background: #e7f3ff;
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.15);
}

.option-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.option-header {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.option-name {
    font-weight: 600;
    color: #333;
    font-size: 20px;
}

.option-price {
    font-weight: 700;
    color: #007bff;
    font-size: 22px;
}

.option-desc {
    color: #6c757d;
    font-size: 18px;
}

/* Payment Methods */
.payment-methods {
    display: flex;
    gap: 20px;
    margin-bottom: 25px;
}

.payment-method {
    position: relative;
}

.payment-method input[type="radio"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.payment-method label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 17px 22px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
    font-weight: 600;
    font-size: 20px;
}

.payment-method input[type="radio"]:checked + label {
    border-color: #007bff;
    background: #e7f3ff;
}

.payment-method i {
    font-size: 18px;
    color: #007bff;
}

/* Credit Card Form */
.credit-card-form {
    background: #f8f9fa;
    padding: 27px;
    border-radius: 12px;
    border: 1px solid #e9ecef;
}

/* Terms and Conditions */
.form-check {
    margin-bottom: 0;
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.form-check-input {
    margin-top: 4px;
    transform: scale(1.2);
}

.form-check-label {
    font-size: 20px;
    color: #495057;
    line-height: 1.4;
}

.terms-link {
    color: #007bff;
    text-decoration: none;
}

.terms-link:hover {
    text-decoration: underline;
}

/* Checkout Button */
.checkout-btn {
    width: 100%;
    padding: 22px 32px;
    font-size: 22px;
    font-weight: 700;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
}

.checkout-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
}

/* Order Summary */
.order-summary-container {
    position: sticky;
    top: 100px;
}

.order-summary {
    background: white;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    position: sticky;
    top: 100px;
    border: 1px solid rgba(255,255,255,0.8);
}

.summary-title {
    font-size: 26px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e9ecef;
}

.summary-title i {
    color: #007bff;
}

.summary-items {
    margin-bottom: 20px;
    max-height: 300px;
    overflow-y: auto;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 0;
    border-bottom: 1px solid #f1f3f4;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item img {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 8px;
}

.summary-item-details {
    flex: 1;
}

.summary-item-name {
    font-weight: 600;
    color: #333;
    font-size: 18px;
    margin-bottom: 5px;
}

.summary-item-meta {
    font-size: 16px;
    color: #6c757d;
}

.summary-item-price {
    font-weight: 700;
    color: #007bff;
    font-size: 20px;
}

.summary-totals {
    border-top: 2px solid #e9ecef;
    padding-top: 20px;
    margin-bottom: 20px;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 20px;
}

.summary-row.total {
    font-size: 24px;
    font-weight: 700;
    color: #333;
    border-top: 1px solid #e9ecef;
    padding-top: 15px;
    margin-top: 15px;
}

.summary-actions {
    text-align: center;
}

.summary-actions .btn {
    width: 100%;
    padding: 14px 22px;
    font-size: 18px;
}

/* Toast Notifications */
.toast-notification {
    position: fixed;
    top: 80px;
    right: 20px;
    background: #28a745;
    color: white;
    padding: 12px 16px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 9999;
    transform: translateY(-100px);
    transition: all 0.3s ease-in-out;
    max-width: 250px;
    border-left: 3px solid #fff;
    font-size: 14px;
    opacity: 0;
}

.toast-notification.show {
    transform: translateY(0);
    opacity: 1;
}

.toast-notification::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 15px;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid var(--arrow-color, #28a745);
}

.toast-notification.success {
    background: #28a745;
    --arrow-color: #28a745;
}

.toast-notification.error {
    background: #dc3545;
    --arrow-color: #dc3545;
}

.toast-notification.info {
    background: #17a2b8;
    --arrow-color: #17a2b8;
}

.toast-content {
    display: flex;
    align-items: center;
    gap: 10px;
}

.toast-icon {
    font-size: 20px;
    color: #fff;
}

.toast-message {
    font-size: 18px;
    font-weight: 600;
}

/* Responsive Design */
@media (max-width: 991px) {
    .order-summary-container {
        position: static;
        margin-top: 20px;
    }
    
    .order-summary {
        position: static;
    }
}

/* Center container with balanced padding */
.container {
    padding-left: 20px;
    padding-right: 20px;
    margin-left: auto;
    margin-right: auto;
    max-width: 1400px;
}

@media (min-width: 768px) {
    .container {
        padding-left: 30px;
        padding-right: 30px;
    }
}

@media (min-width: 1200px) {
    .container {
        padding-left: 40px;
        padding-right: 40px;
    }
}

@media (max-width: 767px) {
    .checkout-form-container {
        padding: 20px;
    }
    
    .checkout-title {
        font-size: 32px;
    }
    
    .checkout-subtitle {
        font-size: 18px;
    }
    
    .section-title {
        font-size: 20px;
    }
    
    .form-group label {
        font-size: 16px;
    }
    
    .form-control {
        font-size: 16px;
        padding: 12px 16px;
    }
    
    .payment-methods {
        flex-direction: column;
        gap: 15px;
    }
    
    .shipping-option label {
        padding: 15px;
    }
    
    .option-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .option-name {
        font-size: 16px;
    }
    
    .option-price {
        font-size: 18px;
    }
    
    .option-desc {
        font-size: 14px;
    }
    
    .checkout-btn {
        font-size: 18px;
        padding: 18px 25px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check if user has items to checkout
    const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems') || '[]');
    if (checkoutItems.length === 0) {
        // Redirect back to cart if no items
        showToast('No items selected for checkout. Redirecting to cart...', 'error');
        setTimeout(() => {
            window.location.href = "{% url 'main:cart' %}";
        }, 2000);
        return;
    }
    
    // Load cart items and populate order summary
    loadOrderSummary();
    
    // Handle shipping option changes
    document.querySelectorAll('input[name="shipping"]').forEach(radio => {
        radio.addEventListener('change', updateShippingCost);
    });
    
    // Handle payment method changes
    document.querySelectorAll('input[name="payment"]').forEach(radio => {
        radio.addEventListener('change', togglePaymentForm);
    });
    
    // Handle form submission
    document.getElementById('checkout-form').addEventListener('submit', handleCheckout);
    
    // Format card number input
    document.getElementById('card_number').addEventListener('input', formatCardNumber);
    
    // Format expiry date input
    document.getElementById('expiry').addEventListener('input', formatExpiryDate);
    
    // Format CVV input
    document.getElementById('cvv').addEventListener('input', formatCVV);
});

// Load order summary from cart
function loadOrderSummary() {
    // Get checkout items (selected items from cart)
    const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems') || '[]');
    const summaryItems = document.getElementById('summary-items');
    
    if (checkoutItems.length === 0) {
        summaryItems.innerHTML = '<p class="text-center text-muted">No items selected for checkout</p>';
        return;
    }
    
    let itemsHTML = '';
    let subtotal = 0;
    
    checkoutItems.forEach(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        
        itemsHTML += `
            <div class="summary-item">
                <img src="${item.image}" alt="${item.name}">
                <div class="summary-item-details">
                    <div class="summary-item-name">${item.name}</div>
                    <div class="summary-item-meta">Qty: ${item.quantity} | ${item.size} | ${item.color}</div>
                </div>
                <div class="summary-item-price">$${itemTotal.toFixed(2)}</div>
            </div>
        `;
    });
    
    summaryItems.innerHTML = itemsHTML;
    
    // Update totals
    updateTotals(subtotal);
}

// Update shipping cost and totals
function updateShippingCost() {
    const selectedShipping = document.querySelector('input[name="shipping"]:checked').value;
    let shippingCost = 2.00; // Default standard shipping
    
    switch(selectedShipping) {
        case 'express':
            shippingCost = 8.00;
            break;
        case 'overnight':
            shippingCost = 15.00;
            break;
    }
    
    document.getElementById('shipping-cost').textContent = `$${shippingCost.toFixed(2)}`;
    
    // Recalculate totals
    const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace('$', ''));
    updateTotals(subtotal);
}

// Update totals
function updateTotals(subtotal) {
    const shippingCost = parseFloat(document.getElementById('shipping-cost').textContent.replace('$', ''));
    const taxRate = 0.08; // 8% tax rate
    const taxAmount = subtotal * taxRate;
    const total = subtotal + shippingCost + taxAmount;
    
    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('tax-amount').textContent = `$${taxAmount.toFixed(2)}`;
    document.getElementById('total-amount').textContent = `$${total.toFixed(2)}`;
}

// Toggle payment form based on selected method
function togglePaymentForm() {
    const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
    const creditCardForm = document.getElementById('credit-card-form');
    
    if (selectedPayment === 'credit_card') {
        creditCardForm.style.display = 'block';
    } else {
        creditCardForm.style.display = 'none';
    }
}

// Format card number with spaces
function formatCardNumber(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
    e.target.value = formattedValue;
}

// Format expiry date
function formatExpiryDate(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 2) {
        value = value.slice(0, 2) + '/' + value.slice(2, 4);
    }
    e.target.value = value;
}

// Format CVV
function formatCVV(e) {
    e.target.value = e.target.value.replace(/\D/g, '');
}

// Handle checkout form submission
function handleCheckout(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateForm()) {
        return;
    }
    
    // Show loading state
    const submitBtn = document.getElementById('place-order-btn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    submitBtn.disabled = true;
    
    // Simulate order processing
    setTimeout(() => {
        // Clear cart and checkout items
        localStorage.removeItem('cart');
        localStorage.removeItem('checkoutItems');
        
        // Show success message
        showToast('Order placed successfully!', 'success');
        
        // Redirect to confirmation page or home
        setTimeout(() => {
            window.location.href = "{% url 'main:home' %}";
        }, 2000);
    }, 3000);
}

// Validate form
function validateForm() {
    const requiredFields = document.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
        }
    });
    
    // Validate card details if credit card is selected
    const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
    if (selectedPayment === 'credit_card') {
        const cardNumber = document.getElementById('card_number').value.replace(/\s/g, '');
        const expiry = document.getElementById('expiry').value;
        const cvv = document.getElementById('cvv').value;
        const cardName = document.getElementById('card_name').value;
        
        if (cardNumber.length < 13 || cardNumber.length > 19) {
            document.getElementById('card_number').classList.add('is-invalid');
            isValid = false;
        }
        
        if (!expiry.match(/^\d{2}\/\d{2}$/)) {
            document.getElementById('expiry').classList.add('is-invalid');
            isValid = false;
        }
        
        if (cvv.length < 3 || cvv.length > 4) {
            document.getElementById('cvv').classList.add('is-invalid');
            isValid = false;
        }
        
        if (!cardName.trim()) {
            document.getElementById('card_name').classList.add('is-invalid');
            isValid = false;
        }
    }
    
    if (!isValid) {
        showToast('Please fill in all required fields correctly.', 'error');
    }
    
    return isValid;
}

// Show toast notification
function showToast(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast-notification ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} toast-icon"></i>
            <span class="toast-message">${message}</span>
        </div>
    `;
    
    // Add to page
    document.body.appendChild(toast);
    
    // Show toast
    setTimeout(() => toast.classList.add('show'), 100);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast && toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 5000);
}
</script>
{% endblock %}
